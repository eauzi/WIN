<head>
	<script>

		var joke;
		var setup;
		var delivery;	
		var maxWidth = 400;
		var lineHeight = 24;

			function wrapText(context, text, x, y, maxWidth, lineHeight) {
				var words = text.split(' ');
				var line = '';

				for (var n = 0; n < words.length; n++) {
					var testLine = line + words[n] + ' ';
					var metrics = context.measureText(testLine);
					var testWidth = metrics.width;
					if (testWidth > maxWidth && n > 0) {
						context.fillText(line, x, y);
						line = words[n] + ' ';
						y += lineHeight;
					}
					else {
						line = testLine;
					}
				}
				context.fillText(line, x, y);
			}




		function FaireBlagues() {
			fetch('https://sv443.net/jokeapi/category/any?blacklistFlags=nsfwreligiouspolitical').then(response => {
				return response.json()
			})
				.then(data => {
					// Work with JSON data here

					if (data.type == "single") {
						joke = data.joke;
					}
					else {
						setup = data.setup;
						delivery = data.delivery;
					}


				})
				.catch(err => {
					// Do something for an error here
				})

		}


		function afficherBulle() {
			FaireBlagues();
			var img = document.createElement("img");
			img.src = "bulleBd.jpg";

			if (joke != null) {

				var canvas = document.getElementById('canvas');
				var ctx = canvas.getContext('2d');
				ctx.clearRect(0, 0, 1600, 800);
				ctx.drawImage(img, 50, 50);

				ctx.font = "30px Arial";
				wrapText(ctx, joke, 100, 200, maxWidth, lineHeight);

			}
			else if((setup != null) && (delivery!=null)) {


				var canvas = document.getElementById('canvas');
				var ctx = canvas.getContext('2d');
				ctx.clearRect(0, 0, 1600, 800);
				ctx.drawImage(img, 10, 10);
				ctx.drawImage(img, 800, 10);

				ctx.font = "30px Arial";
				wrapText(ctx, setup, 100, 200, maxWidth, lineHeight);
				wrapText(ctx, delivery, 900, 200, maxWidth, lineHeight);

			}

		}


	</script>


</head>

<body>
	<h1>Bienvenue sur WIN</h1>
	<button onclick="FaireBlagues()"> Acc√©der aux blagues</button> </br></br>
	<button onclick="afficherBulle()"> Afficher bulle</button> </br></br>

	<div>
		<canvas id="canvas" width="1600" height="800" style="border:1px solid #000000;"></canvas>
	</div>
</body>


</html>